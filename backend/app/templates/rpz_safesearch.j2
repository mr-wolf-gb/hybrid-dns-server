; Response Policy Zone - SafeSearch Enforcement
; Generated automatically by Hybrid DNS Server
; Category: SafeSearch Enforcement
; Description: Enforces safe search on popular search engines
; Total Rules: {{ rules|length if rules else 0 }}
; Active Rules: {{ active_rules_count | default(0) }}
; Last Updated: {{ generated_at.strftime('%Y-%m-%d %H:%M:%S') }}
; SafeSearch Providers: {{ enabled_providers | join(', ') if enabled_providers else 'All' }}

$TTL {{ ttl | default(60) }}
$ORIGIN {{ zone_name | default('rpz.safesearch') }}.

; SOA Record for SafeSearch Enforcement RPZ
@	IN	SOA	{{ primary_ns | default('localhost.') }} {{ admin_email | default('admin.localhost.') }} (
		{{ serial | default(generated_at.strftime('%Y%m%d%H')) }}	; Serial number (YYYYMMDDHH)
		{{ refresh | default(86400) }}		; Refresh interval (24 hours)
		{{ retry | default(7200) }}		; Retry interval (2 hours)
		{{ expire | default(604800) }}		; Expire time (1 week)
		{{ minimum | default(60) }}		; Minimum TTL (1 minute)
		)

; Name Server Record
@	IN	NS	{{ primary_ns | default('localhost.') }}

; ========================================
; SAFESEARCH ENFORCEMENT RULES
; ========================================
; This zone redirects search engines to their SafeSearch-enabled versions
; Supported search engines:
; - Google (forcesafesearch.google.com)
; - YouTube (restricted mode)
; - Bing (strict.bing.com)
; - DuckDuckGo (safe.duckduckgo.com)
; - Yahoo (family.yahoo.com)
; - Yandex (family.yandex.com)

{% if google_safesearch | default(true) %}
; ========================================
; GOOGLE SAFESEARCH ENFORCEMENT
; ========================================
; Redirect Google searches to forcesafesearch.google.com (216.239.38.120)
; This enforces SafeSearch for all Google domains and subdomains

google.com			IN	A	216.239.38.120
*.google.com			IN	A	216.239.38.120
google.co.uk			IN	A	216.239.38.120
*.google.co.uk			IN	A	216.239.38.120
google.ca			IN	A	216.239.38.120
*.google.ca			IN	A	216.239.38.120
google.com.au			IN	A	216.239.38.120
*.google.com.au			IN	A	216.239.38.120
google.de			IN	A	216.239.38.120
*.google.de			IN	A	216.239.38.120
google.fr			IN	A	216.239.38.120
*.google.fr			IN	A	216.239.38.120
google.it			IN	A	216.239.38.120
*.google.it			IN	A	216.239.38.120
google.es			IN	A	216.239.38.120
*.google.es			IN	A	216.239.38.120
google.nl			IN	A	216.239.38.120
*.google.nl			IN	A	216.239.38.120
google.be			IN	A	216.239.38.120
*.google.be			IN	A	216.239.38.120
google.ch			IN	A	216.239.38.120
*.google.ch			IN	A	216.239.38.120

{% endif %}
{% if youtube_safesearch | default(true) %}
; ========================================
; YOUTUBE RESTRICTED MODE ENFORCEMENT
; ========================================
; Redirect YouTube to restricted mode (216.239.38.119)
; This enables YouTube's restricted mode for content filtering

youtube.com			IN	A	216.239.38.119
*.youtube.com			IN	A	216.239.38.119
youtu.be			IN	A	216.239.38.119
m.youtube.com			IN	A	216.239.38.119
music.youtube.com		IN	A	216.239.38.119

{% endif %}
{% if bing_safesearch | default(true) %}
; ========================================
; BING SAFESEARCH ENFORCEMENT
; ========================================
; Redirect Bing searches to strict.bing.com
; This enforces strict SafeSearch filtering on Bing

bing.com			IN	CNAME	strict.bing.com.
*.bing.com			IN	CNAME	strict.bing.com.
bing.co.uk			IN	CNAME	strict.bing.com.
*.bing.co.uk			IN	CNAME	strict.bing.com.

{% endif %}
{% if duckduckgo_safesearch | default(true) %}
; ========================================
; DUCKDUCKGO SAFESEARCH ENFORCEMENT
; ========================================
; Redirect DuckDuckGo to safe search mode
; Note: DuckDuckGo has moderate safe search by default

duckduckgo.com			IN	CNAME	safe.duckduckgo.com.
*.duckduckgo.com		IN	CNAME	safe.duckduckgo.com.

{% endif %}
{% if yahoo_safesearch | default(true) %}
; ========================================
; YAHOO SAFESEARCH ENFORCEMENT
; ========================================
; Redirect Yahoo searches to family-friendly version

yahoo.com			IN	CNAME	family.yahoo.com.
*.yahoo.com			IN	CNAME	family.yahoo.com.
yahoo.co.uk			IN	CNAME	family.yahoo.com.
*.yahoo.co.uk			IN	CNAME	family.yahoo.com.

{% endif %}
{% if yandex_safesearch | default(false) %}
; ========================================
; YANDEX SAFESEARCH ENFORCEMENT
; ========================================
; Redirect Yandex searches to family search (213.180.193.56)
; Note: Enable only if Yandex is used in your region

yandex.com			IN	A	213.180.193.56
*.yandex.com			IN	A	213.180.193.56
yandex.ru			IN	A	213.180.193.56
*.yandex.ru			IN	A	213.180.193.56

{% endif %}
{% if custom_search_redirects %}
; ========================================
; CUSTOM SEARCH ENGINE REDIRECTS
; ========================================
; Custom search engine redirections configured via web interface

{% for redirect in custom_search_redirects %}
{% if redirect.is_active %}
; {{ redirect.description if redirect.description else 'Custom redirect for ' + redirect.source_domain }}
{{ redirect.source_domain }}	IN	{{ redirect.record_type }}	{{ redirect.target }}
{% if redirect.include_subdomains %}*.{{ redirect.source_domain }}	IN	{{ redirect.record_type }}	{{ redirect.target }}{% endif %}
{% endif %}
{% endfor %}

{% endif %}
{% if rules %}
; ========================================
; ADDITIONAL SAFESEARCH RULES
; ========================================
; Additional SafeSearch rules configured via database

{% for rule in rules %}
{% if rule.is_active %}
{% if rule.description %}; {{ rule.description }}{% endif %}
{% if rule.action == 'redirect' %}
{{ rule.domain | rpz_format_domain }}	IN	CNAME	{{ rule.redirect_target | ensure_trailing_dot }}{% if rule.source %} ; Source: {{ rule.source }}{% endif %}
{% elif rule.action == 'block' %}
{{ rule.domain | rpz_format_domain }}	IN	CNAME	.{% if rule.source %} ; Source: {{ rule.source }}{% endif %}
{% elif rule.action == 'passthru' %}
{{ rule.domain | rpz_format_domain }}	IN	CNAME	rpz-passthru.{% if rule.source %} ; Source: {{ rule.source }}{% endif %}
{% endif %}
{% endif %}
{% endfor %}

{% endif %}
; ========================================
; SAFESEARCH CONFIGURATION NOTES
; ========================================
; SafeSearch IP Addresses (as of {{ generated_at.strftime('%Y-%m-%d') }}):
; - Google SafeSearch: 216.239.38.120
; - YouTube Restricted: 216.239.38.119
; - Yandex Family: 213.180.193.56
;
; CNAME Targets:
; - Bing Strict: strict.bing.com
; - DuckDuckGo Safe: safe.duckduckgo.com
; - Yahoo Family: family.yahoo.com
;
; Note: These addresses may change. Verify periodically and update as needed.
; Some search engines may require additional configuration or API keys.

; ========================================
; BYPASS INSTRUCTIONS
; ========================================
; To temporarily bypass SafeSearch for administrative purposes:
; 1. Use direct IP addresses instead of domain names
; 2. Configure specific client exemptions in BIND ACLs
; 3. Use alternative DNS servers for specific devices
; 4. Disable this RPZ zone temporarily via web interface

; ========================================
; STATISTICS SUMMARY
; ========================================
; Google SafeSearch: {{ 'Enabled' if google_safesearch | default(true) else 'Disabled' }}
; YouTube Restricted: {{ 'Enabled' if youtube_safesearch | default(true) else 'Disabled' }}
; Bing SafeSearch: {{ 'Enabled' if bing_safesearch | default(true) else 'Disabled' }}
; DuckDuckGo Safe: {{ 'Enabled' if duckduckgo_safesearch | default(true) else 'Disabled' }}
; Yahoo SafeSearch: {{ 'Enabled' if yahoo_safesearch | default(true) else 'Disabled' }}
; Yandex SafeSearch: {{ 'Enabled' if yandex_safesearch | default(false) else 'Disabled' }}
; Custom Redirects: {{ custom_search_redirects|length if custom_search_redirects else 0 }}
; Additional Rules: {{ rules|length if rules else 0 }}

; End of SafeSearch Enforcement RPZ zone